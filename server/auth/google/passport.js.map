{"version":3,"sources":["auth/google/passport.js"],"names":[],"mappings":";;;;;QAIgB,K,GAAA,K;;AAJhB;;;;AACA;;AACA;;;;;;AAEO,SAAS,KAAT,CAAe,IAAf,EAAqB,MAArB,EAA6B;AAClC,qBAAS,GAAT,CAAa,kCAAmB;AAC9B,cAAU,OAAO,MAAP,CAAc,QADM;AAE9B,kBAAc,OAAO,MAAP,CAAc,YAFE;AAG9B,iBAAa,OAAO,MAAP,CAAc;AAHG,GAAnB,EAKb,UAAS,WAAT,EAAsB,YAAtB,EAAoC,OAApC,EAA6C,IAA7C,EAAmD;AACjD,SAAK,OAAL,CAAa,EAAC,aAAa,QAAQ,EAAtB,EAAb,EAAwC,IAAxC,GACG,IADH,CACQ,gBAAQ;;AAEZ,UAAG,OAAO,MAAP,KAAkB,QAAQ,MAAR,CAAe,CAAf,EAAkB,KAAlB,CAAwB,KAAxB,CAA8B,GAA9B,EAAmC,CAAnC,CAArB,EAA2D;AACzD,eAAO,KAAK,IAAL,EAAW,KAAX,EAAkB,EAAE,SAAU,+BAAZ,EAAlB,CAAP;AACD;;AAED,UAAI,IAAJ,EAAU;AACR,eAAO,KAAK,IAAL,EAAW,IAAX,CAAP;AACD;;AAED,aAAO,IAAI,IAAJ,CAAS;AACd,cAAM,QAAQ,WADA;AAEd,eAAO,QAAQ,MAAR,CAAe,CAAf,EAAkB,KAFX;AAGd,kBAAU,QAAQ,MAAR,CAAe,CAAf,EAAkB,KAAlB,CAAwB,KAAxB,CAA8B,GAA9B,EAAmC,CAAnC,CAHI;AAId,kBAAU,QAJI;AAKd,gBAAQ,QAAQ;AALF,OAAT,CAAP;AAOA,WAAK,IAAL,GACG,IADH,CACQ;AAAA,eAAQ,KAAK,IAAL,EAAW,IAAX,CAAR;AAAA,OADR,EAEG,KAFH,CAES;AAAA,eAAO,KAAK,GAAL,CAAP;AAAA,OAFT;AAGD,KArBH,EAsBG,KAtBH,CAsBS;AAAA,aAAO,KAAK,GAAL,CAAP;AAAA,KAtBT;AAuBD,GA7BY,CAAb;AA8BD","file":"auth/google/passport.js","sourcesContent":["import passport from 'passport';\nimport {Strategy as GoogleStrategy} from 'passport-google-oauth20';\nimport error from '../../components/errors';\n\nexport function setup(User, config) {\n  passport.use(new GoogleStrategy({\n    clientID: config.google.clientID,\n    clientSecret: config.google.clientSecret,\n    callbackURL: config.google.callbackURL    \n  },\n  function(accessToken, refreshToken, profile, done) {\n    User.findOne({'google.id': profile.id}).exec()\n      .then(user => {\n\n        if(config.domain !== profile.emails[0].value.split('@')[1]){\n          return done(null, false, { message : \"error-message-invalid-account\" });\n        }\n\n        if (user) {\n          return done(null, user);\n        }\n\n        user = new User({\n          name: profile.displayName,\n          email: profile.emails[0].value,\n          username: profile.emails[0].value.split('@')[0],\n          provider: 'google',\n          google: profile._json\n        });\n        user.save()\n          .then(user => done(null, user))\n          .catch(err => done(err));\n      })\n      .catch(err => done(err));\n  }));\n}\n"],"sourceRoot":"/source/"}