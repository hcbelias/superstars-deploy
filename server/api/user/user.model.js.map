{"version":3,"sources":["api/user/user.model.js"],"names":["Promise","require","authTypes","experienceSchema","position","type","String","required","company","project","client","startDate","Date","skills","Array","default","endDate","isCurrentPosition","Boolean","activityDescription","skillSchema","name","trim","experienceYears","Number","educationSchema","school","degree","field","activities","certificationSchema","authority","languageSchema","level","hobbySchema","UserSchema","username","unique","email","lowercase","city","currentPosition","currentLocation","role","isActive","external_id","skype","facebook","twitter","linkedIn","provider","salt","google","currentClient","currentProject","profileComplete","aboutMe","summaryOfQualification","hobbies","experiences","skillsCloud","education","certifications","languageSkills","toJSON","virtuals","virtual","get","social","getProfilePicture","_id","path","validate","indexOf","length","validatePresenceOf","value","methods","googleData","googleImage","image","profilePicture","url","imagePathRegex","replace","profile","proxyPictureRequest","test","imagePathMatch","match","proxyPictureUrl","model"],"mappings":"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","file":"api/user/user.model.js","sourcesContent":["'use strict';\n\nimport crypto from 'crypto';\nimport mongoose from 'mongoose';\nmongoose.Promise = require('bluebird');\nimport {Schema} from 'mongoose';\nimport config from '../../config/environment';\n\nconst authTypes = ['github', 'twitter', 'facebook', 'google'];\n\nlet experienceSchema = new Schema({\n  position: {\n    type: String,\n    required: true\n  },\n  company: {\n    type: String,\n    required: true\n  },\n  project: String,\n  client: String,\n  startDate: {\n    type: Date,\n    required: true\n  },\n  skills: {\n    type: Array,\n    default: []\n  },\n  endDate: Date,\n  isCurrentPosition: Boolean,\n  activityDescription: String\n});\n\nlet skillSchema = new Schema({\n  name: { type: String, required: 'Skill Name is a required field.', trim: true },\n  experienceYears : { type: Number, default: 0 }\n});\n\nlet educationSchema =  new Schema({\n  school: {\n    type: String,\n    required: 'School Name is a required field.'\n  },\n  degree: {\n    type: String,\n    required: 'Degree is a required field.'\n  },\n  field: {\n    type: String,\n    required: 'Field is a required field.'\n  },\n  activities: String,\n  startDate: {\n    type: Date,\n    required: 'Start Date is a required field.'\n  },\n  endDate: Date\n});\n\nlet certificationSchema =  new Schema({\n  name: {\n    type: String,\n    required: 'Certification Name is a required field.'\n  },\n  authority: {\n    type: String,\n    required: 'Certification Authority is a required field.'\n  },\n  startDate: Date,\n  endDate: Date\n});\n\nlet languageSchema =  new Schema({\n  name: {\n    type: String,\n    required: 'Language is a required field.'\n  },\n  level: { type: Number, default: 1 }\n});\n\nlet hobbySchema = new Schema({\n  name: {\n    type: String,\n    required: 'Hobby name is a required field.'\n  }\n});\n\nlet UserSchema = new Schema({\n    name: {\n      type: String,\n      trim: true\n    },\n    username: {\n      type: String,\n      unique: 'Username should be unique',\n      required: 'Please fill in a username',\n      trim: true\n    },\n    email: {\n      type: String,\n      lowercase: true,\n      required: true\n    },\n    city: {\n      type: String,\n      trim: true\n    },\n    currentPosition: {\n      type: String,\n      trim: true\n    },\n    currentLocation: {\n      type: String,\n      trim: true\n    },\n    role: {\n      type: String,\n      default: 'user'\n    },\n    isActive: {\n      type: Boolean,\n      default: true\n    },\n    external_id: {\n      type: String\n    },\n    skype: {\n      type: String,\n      default: ''\n    },\n    facebook: {\n      type: String,\n      default: ''\n    },\n    twitter: {\n      type: String,\n      default: ''\n    },\n    linkedIn: {\n      type: String,\n      default: ''\n    },\n    provider: String,\n    salt: String,\n\t  google: {},\n    currentClient: {\n      type: String\n    },\n    currentProject: {\n      type: String\n    },\n    profileComplete: {\n      type: Boolean,\n      default: false\n    },\n    aboutMe: {\n      type: String,\n      default: ''\n    },\n    summaryOfQualification: {\n      type: String,\n      default: ''\n    },\n    hobbies: [hobbySchema],\n    experiences: [experienceSchema],\n    skillsCloud: [skillSchema],    \n    education: [educationSchema],\n    certifications: [certificationSchema],\n    languageSkills: [languageSchema]\n  }, {\n  toJSON: {\n    virtuals: true\n  }\n});\n\n/**\n * Virtuals\n */\n\n// Public profile information\nUserSchema\n  .virtual('profile')\n  .get(function() {\n    return {\n\t  'name': this.name,\n    'role': this.role,\n    'email': this.email,\n\t  'position': this.currentPosition,\n\t  'location': this.currentLocation,\n\t  'social': this.social,\n    'picture': this.getProfilePicture(),\n    'isProfileComplete': this.profileComplete,\n    'username': this.username\n\n    };\n  });\n\nUserSchema\n  .virtual('completeProfile')\n  .get(function() {\n    return {\n\t  'name': this.name,\n    'role': this.role,\n    'email': this.email,\n    'username': this.username,\n\t  'position': this.currentPosition,\n\t  'location': this.currentLocation,\n\t  'social': this.social,\n    'picture': this.getProfilePicture(),\n    'languageSkills': this.languageSkills,\n    'certifications': this.certifications,\n    'education': this.education,\n    'summaryOfQualification': this.summaryOfQualification,\n    'aboutMe': this.aboutMe,\n    'skillsCloud': this.skillsCloud,\n    'experiences': this.experiences,\n    'hobbies': this.hobbies\n    };\n  });\n\n//Once our model is changing, I'm creating this virtual prop to keep the contract unchanged\nUserSchema\n  .virtual('social')\n  .get(function() {\n    return {\n\t  'skype': this.skype,\n    'facebook': this.facebook,\n    'linkedIn': this.linkedIn,\n    'twitter': this.twitter\n    };\n  });\n\n\n// Non-sensitive info we'll be putting in the token\nUserSchema\n  .virtual('token')\n  .get(function() {\n    return {\n      '_id': this._id,\n      'role': this.role\n    };\n  });\n\n/**\n * Validations\n */\n\n// Validate empty email\nUserSchema\n  .path('email')\n  .validate(function(email) {\n    if (authTypes.indexOf(this.provider) !== -1) {\n      return true;\n    }\n    return email.length;\n  }, 'Email cannot be blank');\n\nvar validatePresenceOf = function(value) {\n  return value && value.length;\n};\n\n/**\n * Methods\n */\nUserSchema.methods = {\n\n  /**\n   * Convert a Google picture url to a local one if `proxyPictureRequest` is set to TRUE.\n   *   Google Url: https://lh6.googleusercontent.com/-cDUEyHTb5Pk/AAAAAAAAAAI/AAAAAAAAAEA/6vTpsC0MmC4/photo.jpg?sz=50\n   *   Local Url: /images/profile/lh6/-cDUEyHTb5Pk/AAAAAAAAAAI/AAAAAAAAAEA/6vTpsC0MmC4/photo.jpg?sz=200\n   *\n   * @return {String}\n   * @api public\n   */\n  getProfilePicture: function() {\n    let googleData = this.google || {},\n        googleImage = googleData.image || {},\n        profilePicture = googleImage.url || '',\n        imagePathRegex = /^https?\\:\\/\\/([^\\.]+)\\.googleusercontent\\.com\\/([^\\?]+)(\\?(.*))?$/;\n\n    // Updating the 'sz' (size) parameter to 80 (default: sz=50)\n    profilePicture = profilePicture.replace(/sz\\=\\d+/, 'sz=160');\n\n    if(config.profile.proxyPictureRequest && imagePathRegex.test(profilePicture)) {\n      let imagePathMatch = profilePicture.match(imagePathRegex);\n\n      profilePicture = config.profile.proxyPictureUrl\n        .replace('{host}', imagePathMatch[1])\n        .replace('{imagePath}', imagePathMatch[2])\n        .replace('{querystring}', imagePathMatch[4] || '');\n    }\n\n    return profilePicture;\n  }\n};\n\nexport default mongoose.model('User', UserSchema);\n"],"sourceRoot":"/source/"}