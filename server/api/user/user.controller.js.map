{"version":3,"sources":["api/user/user.controller.js"],"names":["index","show","update","me","searchBySkill","updateSkill","deleteSkill","createSkill","updateLanguage","deleteLanguage","createLanguage","updateExperience","deleteExperience","createExperience","updateEducation","deleteEducation","createEducation","updateCertification","deleteCertification","createCertification","deleteHobby","createHobby","deletePosition","createPosition","updateAboutMe","updateSummary","updateFacebook","updateTwitter","updateLinkedin","updateSkype","authCallback","exportDOCX","exportPDF","TEMPLATE_PATH","__dirname","userWithPropertyNotFoundMsg","userNotFoundMsg","skillProperty","experienceProperty","languageProperty","hobbyProperty","positionProperty","educationProperty","certificationProperty","aboutMeProperty","summaryOfQualificationProperty","facebookContactProperty","twitterContactProperty","skypeContactProperty","linkedinContactProperty","findUserByUsername","username","findOne","exec","respondWithBasicProfileResult","res","statusCode","entity","status","end","json","profile","respondWithBasicProfileResultList","results","users","i","length","push","respondWithCompleteProfileResult","sortResults","completeProfile","education","experiences","certifications","validationError","err","getErrorObject","handleUserNotFound","handleError","send","addQuerySearchSkill","searchRegExp","skillsCloud","$elemMatch","name","$regex","getQuerySearchSkill","querystring","query","searchTerms","queryTerms","q","split","RegExp","$or","getQuerySearchAllFields","currentPosition","currentClient","currentProject","client","project","getQuerySearchByName","$options","req","find","sort","then","catch","next","params","body","findOneAndUpdate","new","userId","user","_id","error","findUserPropertyAndUpdateByUserProperty","action","propertyName","propertyId","id","propertyValue","data","findUserAndCreateUserProperty","createUserProperty","saveEntity","returnValue","code","save","doc","updateUserProperty","property","indexOf","set","deleteUserProperty","remove","updateSimpleField","findUserAndUpdateProperty","redirect","buffer","generateDOCX","setHeader","console","template","readFileSync","zip","docx","loadZip","setData","generateResumeData","render","getZip","generate","type","renderHTMLToPDF","resumeData","log","locals","generatePDF","html","pdf","pipe","arr","field","asc","el1","el2"],"mappings":"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","file":"api/user/user.controller.js","sourcesContent":["'use strict';\n\nimport userReport from '../../components/exportUserProfile';\nimport User from './user.model';\nimport passport from 'passport';\nimport config from '../../config/environment';\nimport jwt from 'jsonwebtoken';\nimport wkhtmltopdf from 'wkhtmltopdf';\n\n\nimport JSZip from 'jszip';\nimport Docx from 'docxtemplater';\nimport fs from 'fs';\n\n\nconst TEMPLATE_PATH = `${__dirname}/../../components/template.docx`;\n\n\nconst userWithPropertyNotFoundMsg = 'User with this property not found';\nconst userNotFoundMsg = 'User not found';\n\n// User Model properties\nconst skillProperty = 'skillsCloud';\nconst experienceProperty = 'experiences';\nconst languageProperty = 'languageSkills';\nconst hobbyProperty = 'hobbies';\nconst positionProperty = 'positions';\nconst educationProperty = 'education';\nconst certificationProperty = 'certifications';\nconst aboutMeProperty = 'aboutMe';\nconst summaryOfQualificationProperty = 'summaryOfQualification';\nconst facebookContactProperty = 'facebook';\nconst twitterContactProperty = 'twitter';\nconst skypeContactProperty = 'skype';\nconst linkedinContactProperty = 'linkedIn';\n\nfunction findUserByUsername(username) {\n  return User.findOne({\n    username: username\n  }).exec();\n}\n\nfunction respondWithBasicProfileResult(res, statusCode) {\n  statusCode = statusCode || 200;\n  return function (entity) {\n    if (!entity)\n      return res.status(404).end();\n\n    return res.status(statusCode).json(entity.profile);\n  };\n}\n\nfunction respondWithBasicProfileResultList(res, statusCode) {\n  let results = [];\n  statusCode = statusCode || 200;\n  return function (users) {\n    if (!users)\n      return res.status(200).json(results);\n\n    for (let i = 0; i < users.length; i++) {\n      results.push(users[i].profile);\n    }\n\n    return res.status(200).json(results);\n  };\n}\n\nfunction respondWithCompleteProfileResult(res, statusCode) {\n  statusCode = statusCode || 200;\n  return function (entity) {\n    if (!entity) {\n      return res.status(404).end();\n    }\n\n    sortResults(entity.completeProfile.education, 'startDate', false);\n    sortResults(entity.completeProfile.experiences, 'startDate', false);\n    sortResults(entity.completeProfile.certifications, 'startDate', false);\n\n    return res.status(statusCode).json(entity.completeProfile);\n  };\n}\n\nfunction validationError(res, statusCode) {\n  statusCode = statusCode || 422;\n  return function (err) {\n    return res.status(statusCode).json(getErrorObject(err));\n  }\n}\n\nfunction handleUserNotFound(res) {\n  return function (entity) {\n    if (!entity) {\n      return res.status(404).end(getErrorObject(userNotFoundMsg));\n    }\n    return entity;\n  };\n}\n\nfunction handleError(res, statusCode) {\n  statusCode = statusCode || 500;\n  return function (err) {\n    return res.status(statusCode).send(getErrorObject(err));\n  };\n}\n\nfunction addQuerySearchSkill(searchRegExp) {\n  return {\n    skillsCloud: {\n      $elemMatch: {\n        name: {\n          $regex: searchRegExp\n        }\n      }\n    }\n  };\n}\n\nfunction getQuerySearchSkill(querystring) {\n  let query = {},\n    searchTerms,\n    queryTerms = [],\n    searchRegExp;\n  //Check if there are query strings\n  if (Object.keys(querystring).length !== 0) {\n    searchTerms = querystring.q.split(' ');\n    for (let i = 0; i < searchTerms.length; i++) {\n      searchRegExp = new RegExp('.*' + searchTerms[i] + '.*', 'i');\n      queryTerms.push(addQuerySearchSkill(searchRegExp));\n    }\n    query = {\n      $or: queryTerms\n    }\n  } else {\n    query = null;\n  }\n  return query;\n}\n\nfunction getQuerySearchAllFields(querystring) {\n  let query = {},\n    searchTerms,\n    queryTerms = [],\n    searchRegExp;\n  //Check if there are query strings\n  if (Object.keys(querystring).length !== 0) {\n    searchTerms = querystring.q.split(' ');\n    for (let i = 0; i < searchTerms.length; i++) {\n      searchRegExp = new RegExp('.*' + searchTerms[i] + '.*', 'i');\n\n      queryTerms.push(addQuerySearchSkill(searchRegExp));\n      queryTerms.push({\n        name: {\n          $regex: searchRegExp\n        }\n      }, {\n        currentPosition: {\n          $regex: searchRegExp\n        }\n      }, {\n        currentClient: {\n          $regex: searchRegExp\n        }\n      }, {\n        currentProject: {\n          $regex: searchRegExp\n        }\n      }, {\n        experiences: {\n          $elemMatch: {\n            client: {\n              $regex: searchRegExp\n            }\n          }\n        }\n      }, {\n        experiences: {\n          $elemMatch: {\n            project: {\n              $regex: searchRegExp\n            }\n          }\n        }\n      });\n    }\n    query = {\n      $or: queryTerms\n    };\n  }\n  return query;\n}\n\nfunction getQuerySearchByName(querystring) {\n  let query = {};\n\n  if (Object.keys(querystring).length !== 0) {\n    query = {\n      name: {\n        $regex: `.*${querystring.q}.*`,\n        $options: 'i'\n      }\n    }\n  }\n\n  return query;\n}\n\n/**\n * Get list of users\n * restriction: 'admin'\n */\nexport function index(req, res) {\n  let query = getQuerySearchByName(req.query);\n\n  return User.find(query).sort({ name: 1 }).exec()\n    .then(respondWithBasicProfileResultList(res))\n    .catch(handleError(res));\n}\n\n/**\n * Get a single user\n */\nexport function show(req, res, next) {\n  const username = req.params.username;\n\n  return findUserByUsername(username)\n    .then(respondWithCompleteProfileResult(res))\n    .catch(err => next(err));\n}\n\n\n\n/**\n * Get a single user\n */\nexport function update(req, res, next) {\n  let username = req.body.username;\n\n  return User.findOneAndUpdate({\n      username: username\n    }, req.body, {\n      new: true\n    }).exec()\n    .then(respondWithCompleteProfileResult(res))\n    .catch(err => next(err));\n}\n\n/**\n * Get my info\n */\nexport function me(req, res, next) {\n  let userId = req.user._id;\n  return User.findOne({\n      _id: userId\n    }).exec()\n    .then(respondWithBasicProfileResult(res))\n    .catch(err => next(err));\n}\n\n/**\n * Search user by skill\n */\nexport function searchBySkill(req, res, next) {\n  let query = getQuerySearchSkill(req.query);\n  if (!query) {\n    return res.status(200).json([]); // if none skill is passed, we dont return users\n  }\n  return User.find(query).exec()\n    .then(respondWithBasicProfileResultList(res))\n    .catch(handleError(res));\n}\n\n\n//  NEW ENDPOINTS AND AUX FUNCTIONS\n\nfunction getErrorObject(error) {\n  return {\n    \"error\": error\n  };\n}\n\nfunction findUserPropertyAndUpdateByUserProperty(req, res, action, propertyName) {\n  const username = req.params.username;\n  const propertyId = req.params.id;\n  const propertyValue = req.body.data;\n  return findUserByUsername(username)\n    .then(handleUserNotFound(res))\n    .then(action(res, propertyName, propertyId, propertyValue))\n    .catch(handleError(res));\n\n}\n\nfunction findUserAndCreateUserProperty(req, res, propertyName) {\n  const username = req.params.username;\n  return findUserByUsername(username)\n    .then(handleUserNotFound(res))\n    .then(createUserProperty(res, propertyName, req.body.data))\n    .catch(handleError(res));\n}\n\nfunction saveEntity(res, entity, returnValue, code) {\n  code = code || 200;\n  return entity.save(function (err, doc) {\n    if (err) return handleError(err);\n    return res.status(code).json(returnValue);\n  });\n}\n\nfunction updateUserProperty(res, propertyName, propertyId, propertyValue) {\n  return function (entity) {\n    let property = entity[propertyName].id(propertyId);\n    if (!property) {\n      return res.status(404).json(getErrorObject(userWithPropertyNotFoundMsg));\n    }\n    let index = entity[propertyName].indexOf(property);\n    entity[propertyName].set(index, propertyValue); //embebbed array must use set\n    return saveEntity(res, entity, entity[propertyName][index]);\n  };\n}\n\nfunction deleteUserProperty(res, propertyName, propertyId, propertyValue) {\n  return function (entity) {\n    let property = entity[propertyName].id(propertyId);\n    if (!property) {\n      return res.status(404).json(getErrorObject(userWithPropertyNotFoundMsg));\n    }\n    property.remove();\n    return saveEntity(res, entity, {}, 204);\n  };\n}\n\nfunction createUserProperty(res, propertyName, propertyValue) {\n  return function (entity) {\n    let property = entity[propertyName];\n    property.push(propertyValue);\n    return saveEntity(res, entity, property[property.length - 1]);\n  };\n}\n\n// SKILL\n\nexport function updateSkill(req, res, next) {\n  return findUserPropertyAndUpdateByUserProperty(req, res, updateUserProperty, skillProperty);\n}\n\nexport function deleteSkill(req, res, next) {\n  return findUserPropertyAndUpdateByUserProperty(req, res, deleteUserProperty, skillProperty);\n}\n\nexport function createSkill(req, res, next) {\n  return findUserAndCreateUserProperty(req, res, skillProperty);\n}\n\n\n// Language\nexport function updateLanguage(req, res, next) {\n  return findUserPropertyAndUpdateByUserProperty(req, res, updateUserProperty, languageProperty);\n}\n\nexport function deleteLanguage(req, res, next) {\n  return findUserPropertyAndUpdateByUserProperty(req, res, deleteUserProperty, languageProperty);\n}\n\nexport function createLanguage(req, res, next) {\n  return findUserAndCreateUserProperty(req, res, languageProperty);\n}\n\n\n// Experience\nexport function updateExperience(req, res, next) {\n  return findUserPropertyAndUpdateByUserProperty(req, res, updateUserProperty, experienceProperty);\n}\n\nexport function deleteExperience(req, res, next) {\n  return findUserPropertyAndUpdateByUserProperty(req, res, deleteUserProperty, experienceProperty);\n}\n\nexport function createExperience(req, res, next) {\n  return findUserAndCreateUserProperty(req, res, experienceProperty);\n}\n\n\n// Education\nexport function updateEducation(req, res, next) {\n  return findUserPropertyAndUpdateByUserProperty(req, res, updateUserProperty, educationProperty);\n}\n\nexport function deleteEducation(req, res, next) {\n  return findUserPropertyAndUpdateByUserProperty(req, res, deleteUserProperty, educationProperty);\n}\n\nexport function createEducation(req, res, next) {\n  return findUserAndCreateUserProperty(req, res, educationProperty);\n}\n\n\n// Certification\nexport function updateCertification(req, res, next) {\n  return findUserPropertyAndUpdateByUserProperty(req, res, updateUserProperty, certificationProperty);\n}\n\nexport function deleteCertification(req, res, next) {\n  return findUserPropertyAndUpdateByUserProperty(req, res, deleteUserProperty, certificationProperty);\n}\n\nexport function createCertification(req, res, next) {\n  return findUserAndCreateUserProperty(req, res, certificationProperty);\n}\n\n\n// Hobby\nexport function deleteHobby(req, res, next) {\n  return findUserPropertyAndUpdateByUserProperty(req, res, deleteUserProperty, hobbyProperty);\n}\n\nexport function createHobby(req, res, next) {\n  return findUserAndCreateUserProperty(req, res, hobbyProperty);\n}\n\n// positions\nexport function deletePosition(req, res, next) {\n  return findUserPropertyAndUpdateByUserProperty(req, res, deleteUserProperty, positionProperty);\n}\n\nexport function createPosition(req, res, next) {\n  return findUserAndCreateUserProperty(req, res, positionProperty);\n}\n\n\n//Simple field\nfunction updateSimpleField(res, propertyName, propertyValue) {\n  return function (entity) {\n    entity[propertyName] = propertyValue;\n    return saveEntity(res, entity, {\n      'data': entity[propertyName]\n    });\n  };\n}\n\nfunction findUserAndUpdateProperty(req, res, action, propertyName) {\n  const username = req.params.username;\n  const propertyValue = req.body.data;\n  return findUserByUsername(username)\n    .then(handleUserNotFound(res))\n    .then(action(res, propertyName, propertyValue))\n    .catch(handleError(res));\n}\n\nexport function updateAboutMe(req, res, next) {\n  return findUserAndUpdateProperty(req, res, updateSimpleField, aboutMeProperty);\n}\n\nexport function updateSummary(req, res, next) {\n  return findUserAndUpdateProperty(req, res, updateSimpleField, summaryOfQualificationProperty);\n}\n\nexport function updateFacebook(req, res, next) {\n  return findUserAndUpdateProperty(req, res, updateSimpleField, facebookContactProperty);\n}\n\nexport function updateTwitter(req, res, next) {\n  return findUserAndUpdateProperty(req, res, updateSimpleField, twitterContactProperty);\n}\n\nexport function updateLinkedin(req, res, next) {\n  return findUserAndUpdateProperty(req, res, updateSimpleField, linkedinContactProperty);\n}\n\nexport function updateSkype(req, res, next) {\n  return findUserAndUpdateProperty(req, res, updateSimpleField, skypeContactProperty);\n}\n\n\n/**\n * Authentication callback\n */\nexport function authCallback(req, res, next) {\n  res.redirect('/');\n}\n\n\n/**\n * Export DOCX Resume\n */\n\nexport function exportDOCX(req, res) {\n  findUserByUsername(req.params.username)\n    .then((user) => {\n      if (!user) {\n        return res.status(404).end();\n      }\n\n      let buffer = generateDOCX(user);\n\n      res.setHeader('Content-disposition', `attachment; filename=resume-${user.username}.docx`);\n\n      return res.status(200).send(buffer).end();\n    })\n    .catch(err => {\n      console.error(`Error generating user report: ${err}`);\n      return res.status(400).end();\n    });\n}\n\n\nfunction generateDOCX(user) {\n  let template = fs.readFileSync(TEMPLATE_PATH);\n  let zip = new JSZip(template);\n  let docx = new Docx().loadZip(zip);\n\n  docx.setData(userReport.generateResumeData(user));\n  docx.render();\n\n  return  docx.getZip().generate({type: 'nodebuffer'});\n}\n\nexport function exportPDF(req, res) {\n  findUserByUsername(req.params.username)\n    .then(handleUserNotFound(res))\n    .then(renderHTMLToPDF(res));\n }\n\n function renderHTMLToPDF(res){\n   return function (user) {\n     const resumeData = userReport.generateResumeData(user);\n     console.log(resumeData);\n     res.locals = resumeData;\n     res.render(\"resume/resume\", generatePDF(res));\n   }\n }\n\n function generatePDF(res){\n   return function (err, html) {\n     if(err){\n       console.error(`Error generating user report: ${err}`);\n     }else{\n       let pdf = true; //debugging purpose\n       if(pdf){\n           // Set content type of response\n           res.setHeader('Content-Type', 'application/pdf');\n           return wkhtmltopdf(html).pipe(res);\n       }\n       else{\n          return res.send(html);\n       }\n      }\n   }\n }\n\n/**\n * Sort an array of results\n */\n\nfunction sortResults(arr, field, asc) {\n  arr = arr.sort(function (el1, el2) {\n    if (asc) {\n      return (el1[field] > el2[field]) ? 1 : ((el1[field] < el2[field]) ? -1 : 0);\n    } else {\n      return (el2[field] > el1[field]) ? 1 : ((el2[field] < el1[field]) ? -1 : 0);\n    }\n  });\n}\n"],"sourceRoot":"/source/"}