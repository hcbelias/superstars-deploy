{"version":3,"sources":["api/user/user.controller.js"],"names":["index","show","update","me","searchBySkill","updateSkill","deleteSkill","createSkill","updateLanguage","deleteLanguage","createLanguage","updateExperience","deleteExperience","createExperience","updateEducation","deleteEducation","createEducation","updateCertification","deleteCertification","createCertification","deleteHobby","createHobby","updateAboutMe","updateSummary","updateFacebook","updateTwitter","updateLinkedin","updateSkype","authCallback","Mongo","require","userWithPropertyNotFoundMsg","userNotFoundMsg","skillProperty","experienceProperty","languageProperty","hobbyProperty","educationProperty","certificationProperty","aboutMeProperty","summaryOfQualificationProperty","facebookContactProperty","twitterContactProperty","skypeContactProperty","linkedinContactProperty","findUserByUsername","username","findOne","exec","respondWithBasicProfileResult","res","statusCode","entity","status","end","json","profile","respondWithBasicProfileResultList","results","users","i","length","push","respondWithCompleteProfileResult","sortResults","completeProfile","education","experiences","certifications","validationError","err","getErrorObject","handleUserNotFound","handleError","send","addQuerySearchSkill","queryTerms","searchRegExp","skillsCloud","$elemMatch","skill","$regex","getQuerySearchSkill","querystring","query","searchTerms","q","split","RegExp","$or","getQuerySearchAllFields","name","currentPosition","currentClient","currentProject","client","project","req","find","or","then","catch","next","params","body","findOneAndUpdate","new","userId","user","_id","console","log","error","findUserPropertyAndUpdateByUserProperty","action","propertyName","propertyId","propertyValue","findUserAndCreateUserProperty","createUserProperty","saveEntity","returnValue","code","save","doc","updateUserProperty","property","id","indexOf","set","deleteUserProperty","remove","updateSimpleField","findUserAndUpdateProperty","value","redirect","arr","field","asc","sort","el1","el2"],"mappings":"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","file":"api/user/user.controller.js","sourcesContent":["'use strict';\n\nimport User from './user.model';\nimport passport from 'passport';\nimport config from '../../config/environment';\nimport jwt from 'jsonwebtoken';\nconst Mongo = require('mongodb');\n\n\nconst userWithPropertyNotFoundMsg = 'User with this property not found';\nconst userNotFoundMsg = 'User not found';\n\n// User Model properties\nconst skillProperty = 'skillsCloud';\nconst experienceProperty = 'experiences';\nconst languageProperty = 'languageSkills';\nconst hobbyProperty = 'hobbies';\nconst educationProperty = 'education';\nconst certificationProperty = 'certifications';\nconst aboutMeProperty = 'aboutMe';\nconst summaryOfQualificationProperty = 'summaryOfQualification';\nconst facebookContactProperty = 'facebook';\nconst twitterContactProperty = 'twitter';\nconst skypeContactProperty = 'skype';\nconst linkedinContactProperty = 'linkedIn';\n\nfunction findUserByUsername(username){\n  return User.findOne({ username: username }).exec();\n}\n\nfunction respondWithBasicProfileResult(res, statusCode) {\n  statusCode = statusCode || 200;\n  return function(entity) {\n    if (!entity)\n      return res.status(404).end();\n\n    return res.status(statusCode).json(entity.profile);\n  };\n}\n\nfunction respondWithBasicProfileResultList(res, statusCode) {\n  let results =[];\n  statusCode = statusCode || 200;\n  return function(users) {\n    if(!users)\n      return res.status(200).json(results);\n\n    for(let i = 0; i < users.length; i++){\n      results.push(users[i].profile);\n    }\n    return res.status(200).json(results);\n  };\n}\n\nfunction respondWithCompleteProfileResult(res, statusCode) {\n  statusCode = statusCode || 200;\n  return function(entity) {\n    if (!entity) {\n      return res.status(404).end();\n    }\n\n    sortResults(entity.completeProfile.education, 'startDate', false);\n    sortResults(entity.completeProfile.experiences, 'startDate', false);\n    sortResults(entity.completeProfile.certifications, 'startDate', false);\n\n    return res.status(statusCode).json(entity.completeProfile);\n  };\n}\n\nfunction validationError(res, statusCode) {\n  statusCode = statusCode || 422;\n  return function(err) {\n    return res.status(statusCode).json(getErrorObject(err));\n  }\n}\n\nfunction handleUserNotFound(res) {\n  return function(entity) {\n    if (!entity){\n      return res.status(404).end(getErrorObject(userNotFoundMsg));\n    }\n    return entity;\n  };\n}\n\nfunction handleError(res, statusCode) {\n  statusCode = statusCode || 500;\n  return function(err) {\n    return res.status(statusCode).send(getErrorObject(err));\n  };\n}\n\nfunction addQuerySearchSkill(queryTerms, searchRegExp){\n  queryTerms.push({\n    skillsCloud: {\n      $elemMatch: {\n        skill: {\n          $regex: searchRegExp\n        }\n      }\n    }\n  });\n}\n\nfunction getQuerySearchSkill(querystring){\n  let query = {},\n    searchTerms,\n    queryTerms = [],\n    searchRegExp;\n\n  //Check if there are query strings\n  if (Object.keys(querystring).length !== 0) {\n    searchTerms = querystring.q.split(' ');\n    for (let i = 0; i < searchTerms.length; i++) {\n      searchRegExp = new RegExp('.*' + searchTerms[i] + '.*', 'i');\n      addQuerySearchSkill(queryTerms, searchRegExp);\n    }\n    query = { $or: queryTerms }\n  }else{\n    query = null;\n  }\n  return query;\n}\n\nfunction getQuerySearchAllFields(querystring){\n  let query = {},\n    searchTerms,\n    queryTerms = [],\n    searchRegExp;\n\n  //Check if there are query strings\n  if (Object.keys(querystring).length !== 0) {\n    searchTerms = querystring.q.split(' ');\n    for (let i = 0; i < searchTerms.length; i++) {\n      searchRegExp = new RegExp('.*' + searchTerms[i] + '.*', 'i');\n      addQuerySearchSkill(queryTerms, searchRegExp);\n      queryTerms.push({\n        name: {\n          $regex: searchRegExp\n        }\n      }, {\n        currentPosition: {\n          $regex: searchRegExp\n        }\n      }, {\n        currentClient: {\n          $regex: searchRegExp\n        }\n      }, {\n        currentProject: {\n          $regex: searchRegExp\n        }\n      }, {\n        experiences: {\n          $elemMatch: {\n            client: {\n              $regex: searchRegExp\n            }\n          }\n        }\n      }, {\n        experiences: {\n          $elemMatch: {\n            project: {\n              $regex: searchRegExp\n            }\n          }\n        }\n      });\n    }\n    query =  { $or: queryTerms } ;\n  }\n  return query;\n}\n\n/**\n * Get list of users\n * restriction: 'admin'\n */\nexport function index(req, res) {\n  let query = getQuerySearchAllFields(req.query),\n    results = [];\n\n  return User.find().or(query).exec()\n    .then(respondWithBasicProfileResultList(res))\n    .catch(handleError(res));\n}\n\n/**\n * Get a single user\n */\nexport function show(req, res, next) {\n  const username = req.params.username;\n\n  return findUserByUsername(username)\n    .then(respondWithCompleteProfileResult(res))\n    .catch(err => next(err));\n}\n\n\n\n/**\n * Get a single user\n */\nexport function update(req, res, next) {\n  let username = req.body.username;\n\n  return User.findOneAndUpdate({ username: username }, req.body, { new: true }).exec()\n    .then(respondWithCompleteProfileResult(res))\n    .catch(err => next(err));\n}\n\n/**\n * Get my info\n */\nexport function me(req, res, next) {\n  let userId = req.user._id;\n  return User.findOne({ _id: userId }).exec()\n    .then(respondWithBasicProfileResult(res))\n    .catch(err => next(err));\n}\n\n/**\n* Search user by skill\n*/\nexport function searchBySkill(req, res, next){\n  let query = getQuerySearchSkill(req.query);\n  if(!query){\n    return res.status(200).json([]); // if none skill is passed, we dont return users\n  }\n  console.log(JSON.stringify(query));\n  return User.find(query).exec()\n    .then(respondWithBasicProfileResultList(res))\n    .catch(handleError(res));\n}\n\n\n//  NEW ENDPOINTS AND AUX FUNCTIONS\n\nfunction getErrorObject(error){\n  return { \"error\": error };\n}\n\nfunction findUserPropertyAndUpdateByUserProperty(req, res, action, propertyName) {\n  const username = req.params.username;\n  const propertyId = req.body._id;\n  const propertyValue = req.body;\n  return findUserByUsername(username)\n        .then(handleUserNotFound(res))\n        .then(action(res, propertyName, propertyId, propertyValue))\n        .catch(handleError(res));\n\n}\n\nfunction findUserAndCreateUserProperty(req, res, propertyName) {\n  const username = req.params.username;\n  return findUserByUsername(username)\n        .then(handleUserNotFound(res))\n        .then(createUserProperty(res, propertyName, req.body))\n        .catch(handleError(res));\n}\n\nfunction saveEntity(res, entity, returnValue, code){\n  code = code || 200;\n  return entity.save(function (err, doc) {\n   if (err) return handleError(err);\n   return res.status(code).json(returnValue);\n });\n}\n\nfunction updateUserProperty(res, propertyName, propertyId, propertyValue) {\n  return function(entity) {\n    let property = entity[propertyName].id(propertyId);\n    if(!property){\n      return res.status(404).json(getErrorObject(userWithPropertyNotFoundMsg));\n    }\n    let index = entity[propertyName].indexOf(property);\n    entity[propertyName].set(index, propertyValue); //embebbed array must use set\n    return saveEntity(res, entity, entity[propertyName][index]);\n  };\n}\n\nfunction deleteUserProperty(res, propertyName, propertyId, propertyValue) {\n  return function(entity) {\n    let property = entity[propertyName].id(propertyId);\n    if(!property){\n      return res.status(404).json(getErrorObject(userWithPropertyNotFoundMsg));\n    }\n    property.remove();\n    return saveEntity(res, entity, {}, 204);\n  };\n}\n\nfunction createUserProperty(res, propertyName, propertyValue) {\n  return function(entity) {\n    let property = entity[propertyName];\n    property.push(propertyValue);\n    console.log(propertyValue);\n    return saveEntity(res, entity, property[property.length-1]);\n  };\n}\n\n// SKILL\n\nexport function updateSkill(req, res, next) {\n  return findUserPropertyAndUpdateByUserProperty(req, res, updateUserProperty, skillProperty);\n}\n\nexport function deleteSkill(req, res, next) {\n  return findUserPropertyAndUpdateByUserProperty(req, res, deleteUserProperty, skillProperty);\n}\n\nexport function createSkill(req, res, next) {\n  return findUserAndCreateUserProperty(req, res, skillProperty);\n}\n\n\n// Language\nexport function updateLanguage(req, res, next) {\n  return findUserPropertyAndUpdateByUserProperty(req, res, updateUserProperty, languageProperty);\n}\n\nexport function deleteLanguage(req, res, next) {\n  return findUserPropertyAndUpdateByUserProperty(req, res, deleteUserProperty, languageProperty);\n}\n\nexport function createLanguage(req, res, next) {\n  return findUserAndCreateUserProperty(req, res, languageProperty);\n}\n\n\n// Experience\nexport function updateExperience(req, res, next) {\n  return findUserPropertyAndUpdateByUserProperty(req, res, updateUserProperty, experienceProperty);\n}\n\nexport function deleteExperience(req, res, next) {\n  return findUserPropertyAndUpdateByUserProperty(req, res, deleteUserProperty, experienceProperty);\n}\n\nexport function createExperience(req, res, next) {\n  return findUserAndCreateUserProperty(req, res, experienceProperty);\n}\n\n\n// Education\nexport function updateEducation(req, res, next) {\n  return findUserPropertyAndUpdateByUserProperty(req, res, updateUserProperty, educationProperty);\n}\n\nexport function deleteEducation(req, res, next) {\n  return findUserPropertyAndUpdateByUserProperty(req, res, deleteUserProperty, educationProperty);\n}\n\nexport function createEducation(req, res, next) {\n  return findUserAndCreateUserProperty(req, res, educationProperty);\n}\n\n\n// Certification\nexport function updateCertification(req, res, next) {\n  return findUserPropertyAndUpdateByUserProperty(req, res, updateUserProperty, certificationProperty);\n}\n\nexport function deleteCertification(req, res, next) {\n  return findUserPropertyAndUpdateByUserProperty(req, res, deleteUserProperty, certificationProperty);\n}\n\nexport function createCertification(req, res, next) {\n  return findUserAndCreateUserProperty(req, res, certificationProperty);\n}\n\n\n// Hobby\nexport function deleteHobby(req, res, next) {\n  return findUserPropertyAndUpdateByUserProperty(req, res, deleteUserProperty, hobbyProperty);\n}\n\nexport function createHobby(req, res, next) {\n  return findUserAndCreateUserProperty(req, res, hobbyProperty);\n}\n\n//Simple field\nfunction updateSimpleField(res, propertyName, propertyValue) {\n  return function(entity) {\n    entity[propertyName] = propertyValue;\n    return saveEntity(res, entity, { 'value': entity[propertyName] });\n  };\n}\n\nfunction findUserAndUpdateProperty(req, res, action, propertyName) {\n  const username = req.params.username;\n  const propertyValue = req.body.value;\n  console.log('Property Value - ' + propertyValue);\n  return findUserByUsername(username)\n        .then(handleUserNotFound(res))\n        .then(action(res, propertyName, propertyValue))\n        .catch(handleError(res));\n}\n\nexport function updateAboutMe(req, res, next) {\n  return findUserAndUpdateProperty(req, res, updateSimpleField, aboutMeProperty);\n}\n\nexport function updateSummary(req, res, next) {\n  return findUserAndUpdateProperty(req, res, updateSimpleField, summaryOfQualificationProperty);\n}\n\nexport function updateFacebook(req, res, next) {\n  return findUserAndUpdateProperty(req, res, updateSimpleField, facebookContactProperty);\n}\n\nexport function updateTwitter(req, res, next) {\n  return findUserAndUpdateProperty(req, res, updateSimpleField, twitterContactProperty);\n}\n\nexport function updateLinkedin(req, res, next) {\n  return findUserAndUpdateProperty(req, res, updateSimpleField, linkedinContactProperty);\n}\n\nexport function updateSkype(req, res, next) {\n  return findUserAndUpdateProperty(req, res, updateSimpleField, skypeContactProperty);\n}\n\n\n/**\n * Authentication callback\n */\nexport function authCallback(req, res, next) {\n  res.redirect('/');\n}\n\n/**\n* Sort an array of results\n*/\n\nfunction sortResults(arr, field, asc){\n  arr = arr.sort(function(el1, el2){\n    if(asc){\n      return (el1[field] > el2[field]) ? 1 : ((el1[field] < el2[field]) ? -1 : 0);\n    }\n    else{\n      return (el2[field] > el1[field]) ? 1 : ((el2[field] < el1[field]) ? -1 : 0);\n    }\n  });\n}\n"],"sourceRoot":"/source/"}