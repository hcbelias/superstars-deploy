{"version":3,"sources":["api/user/user.controller.js"],"names":[],"mappings":"AAAA;;;;;;;;;;;;;;QA0IgB,K,GAAA,K;QAYA,I,GAAA,I;QAaA,M,GAAA,M;QAWA,E,GAAA,E;QAUA,a,GAAA,a;QAcA,Y,GAAA,Y;;AApMhB;;;;AACA;;;;AACA;;;;AACA;;;;;;AAEA,SAAS,6BAAT,CAAuC,GAAvC,EAA4C,UAA5C,EAAwD;AACtD,eAAa,cAAc,GAA3B;AACA,SAAO,UAAS,MAAT,EAAiB;AACtB,QAAI,CAAC,MAAL,EACE,OAAO,IAAI,MAAJ,CAAW,GAAX,EAAgB,GAAhB,EAAP;;AAEF,WAAO,IAAI,MAAJ,CAAW,UAAX,EAAuB,IAAvB,CAA4B,OAAO,OAAnC,CAAP;AACD,GALD;AAMD;;AAED,SAAS,iCAAT,CAA2C,GAA3C,EAAgD,UAAhD,EAA4D;AAC1D,MAAI,UAAS,EAAb;AACA,eAAa,cAAc,GAA3B;AACA,SAAO,UAAS,KAAT,EAAgB;AACrB,QAAG,CAAC,KAAJ,EACE,OAAO,IAAI,MAAJ,CAAW,GAAX,EAAgB,IAAhB,CAAqB,OAArB,CAAP;;AAEF,SAAI,IAAI,IAAI,CAAZ,EAAe,IAAI,MAAM,MAAzB,EAAiC,GAAjC,EAAqC;AACnC,cAAQ,IAAR,CAAa,MAAM,CAAN,EAAS,OAAtB;AACD;AACD,WAAO,IAAI,MAAJ,CAAW,GAAX,EAAgB,IAAhB,CAAqB,OAArB,CAAP;AACD,GARD;AASD;AACD,SAAS,gCAAT,CAA0C,GAA1C,EAA+C,UAA/C,EAA2D;AACzD,eAAa,cAAc,GAA3B;AACA,SAAO,UAAS,MAAT,EAAiB;AACtB,QAAI,CAAC,MAAL,EAAa;AACX,aAAO,IAAI,MAAJ,CAAW,GAAX,EAAgB,GAAhB,EAAP;AACD;;AAED,WAAO,IAAI,MAAJ,CAAW,UAAX,EAAuB,IAAvB,CAA4B,OAAO,eAAnC,CAAP;AACD,GAND;AAOD;;AAED,SAAS,eAAT,CAAyB,GAAzB,EAA8B,UAA9B,EAA0C;AACxC,eAAa,cAAc,GAA3B;AACA,SAAO,UAAS,GAAT,EAAc;AACnB,WAAO,IAAI,MAAJ,CAAW,UAAX,EAAuB,IAAvB,CAA4B,GAA5B,CAAP;AACD,GAFD;AAGD;;AAED,SAAS,WAAT,CAAqB,GAArB,EAA0B,UAA1B,EAAsC;AACpC,eAAa,cAAc,GAA3B;AACA,SAAO,UAAS,GAAT,EAAc;AACnB,WAAO,IAAI,MAAJ,CAAW,UAAX,EAAuB,IAAvB,CAA4B,GAA5B,CAAP;AACD,GAFD;AAGD;;AAED,SAAS,mBAAT,CAA6B,UAA7B,EAAyC,YAAzC,EAAsD;AACpD,aAAW,IAAX,CAAgB;AACd,iBAAa;AACX,kBAAY;AACV,eAAO;AACL,kBAAQ;AADH;AADG;AADD;AADC,GAAhB;AASD;;AAED,SAAS,mBAAT,CAA6B,WAA7B,EAAyC;AACvC,MAAI,QAAQ,EAAZ;AAAA,MACE,WADF;AAAA,MAEE,aAAa,EAFf;AAAA,MAGE,YAHF;;;AAMA,MAAI,oBAAY,WAAZ,EAAyB,MAAzB,KAAoC,CAAxC,EAA2C;AACzC,kBAAc,YAAY,CAAZ,CAAc,KAAd,CAAoB,GAApB,CAAd;AACA,SAAK,IAAI,IAAI,CAAb,EAAgB,IAAI,YAAY,MAAhC,EAAwC,GAAxC,EAA6C;AAC3C,qBAAe,IAAI,MAAJ,CAAW,OAAO,YAAY,CAAZ,CAAP,GAAwB,IAAnC,EAAyC,GAAzC,CAAf;AACA,0BAAoB,UAApB,EAAgC,YAAhC;AACD;AACD,YAAQ,EAAE,KAAK,UAAP,EAAR;AACD,GAPD,MAOK;AACH,YAAQ,IAAR;AACD;AACD,SAAO,KAAP;AACD;;AAED,SAAS,uBAAT,CAAiC,WAAjC,EAA6C;AAC3C,MAAI,QAAQ,EAAZ;AAAA,MACE,WADF;AAAA,MAEE,aAAa,EAFf;AAAA,MAGE,YAHF;;;AAMA,MAAI,oBAAY,WAAZ,EAAyB,MAAzB,KAAoC,CAAxC,EAA2C;AACzC,kBAAc,YAAY,CAAZ,CAAc,KAAd,CAAoB,GAApB,CAAd;AACA,SAAK,IAAI,IAAI,CAAb,EAAgB,IAAI,YAAY,MAAhC,EAAwC,GAAxC,EAA6C;AAC3C,qBAAe,IAAI,MAAJ,CAAW,OAAO,YAAY,CAAZ,CAAP,GAAwB,IAAnC,EAAyC,GAAzC,CAAf;AACA,0BAAoB,UAApB,EAAgC,YAAhC;AACA,iBAAW,IAAX,CAAgB;AACd,qBAAa;AACX,kBAAQ;AADG;AADC,OAAhB,EAIG;AACD,uBAAe;AACb,kBAAQ;AADK;AADd,OAJH,EAQG;AACD,wBAAgB;AACd,kBAAQ;AADM;AADf,OARH,EAYG;AACD,qBAAa;AACX,sBAAY;AACV,oBAAQ;AACN,sBAAQ;AADF;AADE;AADD;AADZ,OAZH,EAoBG;AACD,qBAAa;AACX,sBAAY;AACV,qBAAS;AACP,sBAAQ;AADD;AADC;AADD;AADZ,OApBH;AA6BD;AACD,YAAS,EAAE,KAAK,UAAP,EAAT;AACD;AACD,SAAO,KAAP;AACD;;;;;;AAMM,SAAS,KAAT,CAAe,GAAf,EAAoB,GAApB,EAAyB;AAC9B,MAAI,QAAQ,wBAAwB,IAAI,KAA5B,CAAZ;AAAA,MACE,UAAU,EADZ;;AAGA,SAAO,eAAK,IAAL,GAAY,EAAZ,CAAe,KAAf,EAAsB,IAAtB,GACJ,IADI,CACC,kCAAkC,GAAlC,CADD,EAEJ,KAFI,CAEE,YAAY,GAAZ,CAFF,CAAP;AAGD;;;;;AAKM,SAAS,IAAT,CAAc,GAAd,EAAmB,GAAnB,EAAwB,IAAxB,EAA8B;AACnC,MAAI,WAAW,IAAI,MAAJ,CAAW,QAA1B;;AAEA,SAAO,eAAK,OAAL,CAAa,EAAE,UAAU,QAAZ,EAAb,EAAqC,IAArC,GACJ,IADI,CACC,iCAAiC,GAAjC,CADD,EAEJ,KAFI,CAEE;AAAA,WAAO,KAAK,GAAL,CAAP;AAAA,GAFF,CAAP;AAGD;;;;;AAOM,SAAS,MAAT,CAAgB,GAAhB,EAAqB,GAArB,EAA0B,IAA1B,EAAgC;AACrC,MAAI,WAAW,IAAI,MAAJ,CAAW,QAA1B;;AAEA,SAAO,eAAK,gBAAL,CAAsB,EAAE,UAAU,QAAZ,EAAtB,EAA8C,IAAI,IAAlD,EAAwD,EAAE,KAAK,IAAP,EAAxD,EAAuE,IAAvE,GACJ,IADI,CACC,iCAAiC,GAAjC,CADD,EAEJ,KAFI,CAEE;AAAA,WAAO,KAAK,GAAL,CAAP;AAAA,GAFF,CAAP;AAGD;;;;;AAKM,SAAS,EAAT,CAAY,GAAZ,EAAiB,GAAjB,EAAsB,IAAtB,EAA4B;AACjC,MAAI,SAAS,IAAI,IAAJ,CAAS,GAAtB;AACA,SAAO,eAAK,OAAL,CAAa,EAAE,KAAK,MAAP,EAAb,EAA8B,IAA9B,GACJ,IADI,CACC,8BAA8B,GAA9B,CADD,EAEJ,KAFI,CAEE;AAAA,WAAO,KAAK,GAAL,CAAP;AAAA,GAFF,CAAP;AAGD;;;;;AAKM,SAAS,aAAT,CAAuB,GAAvB,EAA4B,GAA5B,EAAiC,IAAjC,EAAsC;AAC3C,MAAI,QAAQ,oBAAoB,IAAI,KAAxB,CAAZ;AACA,MAAG,CAAC,KAAJ,EAAU;AACR,WAAO,IAAI,MAAJ,CAAW,GAAX,EAAgB,IAAhB,CAAqB,EAArB,CAAP,C;AACD;AACD,UAAQ,GAAR,CAAY,yBAAe,KAAf,CAAZ;AACA,SAAO,eAAK,IAAL,CAAU,KAAV,EAAiB,IAAjB,GACJ,IADI,CACC,kCAAkC,GAAlC,CADD,EAEJ,KAFI,CAEE,YAAY,GAAZ,CAFF,CAAP;AAGD;;;;;AAKM,SAAS,YAAT,CAAsB,GAAtB,EAA2B,GAA3B,EAAgC,IAAhC,EAAsC;AAC3C,MAAI,QAAJ,CAAa,GAAb;AACD","file":"api/user/user.controller.js","sourcesContent":["'use strict';\n\nimport User from './user.model';\nimport passport from 'passport';\nimport config from '../../config/environment';\nimport jwt from 'jsonwebtoken';\n\nfunction respondWithBasicProfileResult(res, statusCode) {\n  statusCode = statusCode || 200;\n  return function(entity) {\n    if (!entity)\n      return res.status(404).end();\n\n    return res.status(statusCode).json(entity.profile);\n  };\n}\n\nfunction respondWithBasicProfileResultList(res, statusCode) {\n  var results =[];\n  statusCode = statusCode || 200;\n  return function(users) {\n    if(!users)\n      return res.status(200).json(results);\n\n    for(var i = 0; i < users.length; i++){\n      results.push(users[i].profile);\n    }\n    return res.status(200).json(results);\n  };\n}\nfunction respondWithCompleteProfileResult(res, statusCode) {\n  statusCode = statusCode || 200;\n  return function(entity) {\n    if (!entity) {\n      return res.status(404).end();\n    }\n\n    return res.status(statusCode).json(entity.completeProfile);\n  };\n}\n\nfunction validationError(res, statusCode) {\n  statusCode = statusCode || 422;\n  return function(err) {\n    return res.status(statusCode).json(err);\n  }\n}\n\nfunction handleError(res, statusCode) {\n  statusCode = statusCode || 500;\n  return function(err) {\n    return res.status(statusCode).send(err);\n  };\n}\n\nfunction addQuerySearchSkill(queryTerms, searchRegExp){\n  queryTerms.push({\n    skillsCloud: {\n      $elemMatch: {\n        skill: {\n          $regex: searchRegExp\n        }\n      }\n    }\n  });\n}\n\nfunction getQuerySearchSkill(querystring){\n  var query = {},\n    searchTerms,\n    queryTerms = [],\n    searchRegExp;\n\n  //Check if there are query strings\n  if (Object.keys(querystring).length !== 0) {\n    searchTerms = querystring.q.split(' ');\n    for (var i = 0; i < searchTerms.length; i++) {\n      searchRegExp = new RegExp('.*' + searchTerms[i] + '.*', 'i');\n      addQuerySearchSkill(queryTerms, searchRegExp);\n    }\n    query = { $or: queryTerms }\n  }else{\n    query = null;\n  }\n  return query;\n}\n\nfunction getQuerySearchAllFields(querystring){\n  var query = {},\n    searchTerms,\n    queryTerms = [],\n    searchRegExp;\n\n  //Check if there are query strings\n  if (Object.keys(querystring).length !== 0) {\n    searchTerms = querystring.q.split(' ');\n    for (var i = 0; i < searchTerms.length; i++) {\n      searchRegExp = new RegExp('.*' + searchTerms[i] + '.*', 'i');\n      addQuerySearchSkill(queryTerms, searchRegExp);\n      queryTerms.push({\n        currentRole: {\n          $regex: searchRegExp\n        }\n      }, {\n        currentClient: {\n          $regex: searchRegExp\n        }\n      }, {\n        currentProject: {\n          $regex: searchRegExp\n        }\n      }, {\n        experiences: {\n          $elemMatch: {\n            client: {\n              $regex: searchRegExp\n            }\n          }\n        }\n      }, {\n        experiences: {\n          $elemMatch: {\n            project: {\n              $regex: searchRegExp\n            }\n          }\n        }\n      });\n    }\n    query =  { $or: queryTerms } ;\n  }\n  return query;\n}\n\n/**\n * Get list of users\n * restriction: 'admin'\n */\nexport function index(req, res) {\n  var query = getQuerySearchAllFields(req.query),\n    results = [];\n\n  return User.find().or(query).exec()\n    .then(respondWithBasicProfileResultList(res))\n    .catch(handleError(res));\n}\n\n/**\n * Get a single user\n */\nexport function show(req, res, next) {\n  var username = req.params.username;\n\n  return User.findOne({ username: username }).exec()\n    .then(respondWithCompleteProfileResult(res))\n    .catch(err => next(err));\n}\n\n\n\n/**\n * Get a single user\n */\nexport function update(req, res, next) {\n  var username = req.params.username;\n\n  return User.findOneAndUpdate({ username: username }, req.body, { new: true }).exec()\n    .then(respondWithCompleteProfileResult(res))\n    .catch(err => next(err));\n}\n\n/**\n * Get my info\n */\nexport function me(req, res, next) {\n  var userId = req.user._id;\n  return User.findOne({ _id: userId }).exec()\n    .then(respondWithBasicProfileResult(res))\n    .catch(err => next(err));\n}\n\n/**\n* Search user by skill\n*/\nexport function searchBySkill(req, res, next){\n  var query = getQuerySearchSkill(req.query);\n  if(!query){\n    return res.status(200).json([]); // if none skill is passed, we dont return users\n  }\n  console.log(JSON.stringify(query));\n  return User.find(query).exec()\n    .then(respondWithBasicProfileResultList(res))\n    .catch(handleError(res));\n}\n\n/**\n * Authentication callback\n */\nexport function authCallback(req, res, next) {\n  res.redirect('/');\n}\n"],"sourceRoot":"/source/"}