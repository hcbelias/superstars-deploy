{"version":3,"sources":["api/user/user.controller.js"],"names":["index","show","update","me","searchBySkill","updateSkill","deleteSkill","createSkill","updateLanguage","deleteLanguage","createLanguage","updateExperience","deleteExperience","createExperience","updateEducation","deleteEducation","createEducation","updateCertification","deleteCertification","createCertification","deleteHobby","createHobby","deletePosition","createPosition","updateAboutMe","updateSummary","updateFacebook","updateTwitter","updateLinkedin","updateSkype","authCallback","Mongo","require","userWithPropertyNotFoundMsg","userNotFoundMsg","skillProperty","experienceProperty","languageProperty","hobbyProperty","positionProperty","educationProperty","certificationProperty","aboutMeProperty","summaryOfQualificationProperty","facebookContactProperty","twitterContactProperty","skypeContactProperty","linkedinContactProperty","findUserByUsername","username","findOne","exec","respondWithBasicProfileResult","res","statusCode","entity","status","end","json","profile","respondWithBasicProfileResultList","results","users","i","length","push","respondWithCompleteProfileResult","sortResults","completeProfile","education","experiences","certifications","validationError","err","getErrorObject","handleUserNotFound","handleError","send","addQuerySearchSkill","searchRegExp","skillsCloud","$elemMatch","name","$regex","getQuerySearchSkill","querystring","query","searchTerms","queryTerms","q","split","RegExp","$or","getQuerySearchAllFields","currentPosition","currentClient","currentProject","client","project","req","find","or","then","catch","next","params","body","findOneAndUpdate","new","userId","user","_id","error","findUserPropertyAndUpdateByUserProperty","action","propertyName","propertyId","id","propertyValue","data","findUserAndCreateUserProperty","createUserProperty","saveEntity","returnValue","code","save","doc","updateUserProperty","property","indexOf","set","deleteUserProperty","remove","updateSimpleField","findUserAndUpdateProperty","console","log","redirect","arr","field","asc","sort","el1","el2"],"mappings":"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","file":"api/user/user.controller.js","sourcesContent":["'use strict';\r\n\r\nimport User from './user.model';\r\nimport passport from 'passport';\r\nimport config from '../../config/environment';\r\nimport jwt from 'jsonwebtoken';\r\nconst Mongo = require('mongodb');\r\n\r\n\r\nconst userWithPropertyNotFoundMsg = 'User with this property not found';\r\nconst userNotFoundMsg = 'User not found';\r\n\r\n// User Model properties\r\nconst skillProperty = 'skillsCloud';\r\nconst experienceProperty = 'experiences';\r\nconst languageProperty = 'languageSkills';\r\nconst hobbyProperty = 'hobbies';\r\nconst positionProperty = 'positions';\r\nconst educationProperty = 'education';\r\nconst certificationProperty = 'certifications';\r\nconst aboutMeProperty = 'aboutMe';\r\nconst summaryOfQualificationProperty = 'summaryOfQualification';\r\nconst facebookContactProperty = 'facebook';\r\nconst twitterContactProperty = 'twitter';\r\nconst skypeContactProperty = 'skype';\r\nconst linkedinContactProperty = 'linkedIn';\r\n\r\nfunction findUserByUsername(username) {\r\n  return User.findOne({\r\n    username: username\r\n  }).exec();\r\n}\r\n\r\nfunction respondWithBasicProfileResult(res, statusCode) {\r\n  statusCode = statusCode || 200;\r\n  return function(entity) {\r\n    if (!entity)\r\n      return res.status(404).end();\r\n\r\n    return res.status(statusCode).json(entity.profile);\r\n  };\r\n}\r\n\r\nfunction respondWithBasicProfileResultList(res, statusCode) {\r\n  let results = [];\r\n  statusCode = statusCode || 200;\r\n  return function(users) {\r\n    if (!users)\r\n      return res.status(200).json(results);\r\n\r\n    for (let i = 0; i < users.length; i++) {\r\n      results.push(users[i].profile);\r\n    }\r\n    return res.status(200).json(results);\r\n  };\r\n}\r\n\r\nfunction respondWithCompleteProfileResult(res, statusCode) {\r\n  statusCode = statusCode || 200;\r\n  return function(entity) {\r\n    if (!entity) {\r\n      return res.status(404).end();\r\n    }\r\n\r\n    sortResults(entity.completeProfile.education, 'startDate', false);\r\n    sortResults(entity.completeProfile.experiences, 'startDate', false);\r\n    sortResults(entity.completeProfile.certifications, 'startDate', false);\r\n\r\n    return res.status(statusCode).json(entity.completeProfile);\r\n  };\r\n}\r\n\r\nfunction validationError(res, statusCode) {\r\n  statusCode = statusCode || 422;\r\n  return function(err) {\r\n    return res.status(statusCode).json(getErrorObject(err));\r\n  }\r\n}\r\n\r\nfunction handleUserNotFound(res) {\r\n  return function(entity) {\r\n    if (!entity) {\r\n      return res.status(404).end(getErrorObject(userNotFoundMsg));\r\n    }\r\n    return entity;\r\n  };\r\n}\r\n\r\nfunction handleError(res, statusCode) {\r\n  statusCode = statusCode || 500;\r\n  return function(err) {\r\n    return res.status(statusCode).send(getErrorObject(err));\r\n  };\r\n}\r\n\r\nfunction addQuerySearchSkill(searchRegExp) {\r\n  return {\r\n    skillsCloud: {\r\n      $elemMatch: {\r\n        name: {\r\n          $regex: searchRegExp\r\n        }\r\n      }\r\n    }\r\n  };\r\n}\r\n\r\nfunction getQuerySearchSkill(querystring) {\r\n  let query = {},\r\n    searchTerms,\r\n    queryTerms = [],\r\n    searchRegExp;\r\n  //Check if there are query strings\r\n  if (Object.keys(querystring).length !== 0) {\r\n    searchTerms = querystring.q.split(' ');\r\n    for (let i = 0; i < searchTerms.length; i++) {\r\n      searchRegExp = new RegExp('.*' + searchTerms[i] + '.*', 'i');\r\n      queryTerms.push(addQuerySearchSkill(searchRegExp));\r\n    }\r\n    query = {\r\n      $or: queryTerms\r\n    }\r\n  } else {\r\n    query = null;\r\n  }\r\n  return query;\r\n}\r\n\r\nfunction getQuerySearchAllFields(querystring) {\r\n  let query = {},\r\n    searchTerms,\r\n    queryTerms = [],\r\n    searchRegExp;\r\n  //Check if there are query strings\r\n  if (Object.keys(querystring).length !== 0) {\r\n    searchTerms = querystring.q.split(' ');\r\n    for (let i = 0; i < searchTerms.length; i++) {\r\n      searchRegExp = new RegExp('.*' + searchTerms[i] + '.*', 'i');\r\n\r\n      queryTerms.push(addQuerySearchSkill(searchRegExp));\r\n      queryTerms.push({\r\n        name: {\r\n          $regex: searchRegExp\r\n        }\r\n      }, {\r\n        currentPosition: {\r\n          $regex: searchRegExp\r\n        }\r\n      }, {\r\n        currentClient: {\r\n          $regex: searchRegExp\r\n        }\r\n      }, {\r\n        currentProject: {\r\n          $regex: searchRegExp\r\n        }\r\n      }, {\r\n        experiences: {\r\n          $elemMatch: {\r\n            client: {\r\n              $regex: searchRegExp\r\n            }\r\n          }\r\n        }\r\n      }, {\r\n        experiences: {\r\n          $elemMatch: {\r\n            project: {\r\n              $regex: searchRegExp\r\n            }\r\n          }\r\n        }\r\n      });\r\n    }\r\n    query = {\r\n      $or: queryTerms\r\n    };\r\n  }\r\n  return query;\r\n}\r\n\r\n/**\r\n * Get list of users\r\n * restriction: 'admin'\r\n */\r\nexport function index(req, res) {\r\n  let query = getQuerySearchAllFields(req.query),\r\n    results = [];\r\n\r\n  return User.find().or(query).exec()\r\n    .then(respondWithBasicProfileResultList(res))\r\n    .catch(handleError(res));\r\n}\r\n\r\n/**\r\n * Get a single user\r\n */\r\nexport function show(req, res, next) {\r\n  const username = req.params.username;\r\n\r\n  return findUserByUsername(username)\r\n    .then(respondWithCompleteProfileResult(res))\r\n    .catch(err => next(err));\r\n}\r\n\r\n\r\n\r\n/**\r\n * Get a single user\r\n */\r\nexport function update(req, res, next) {\r\n  let username = req.body.username;\r\n\r\n  return User.findOneAndUpdate({\r\n      username: username\r\n    }, req.body, {\r\n      new: true\r\n    }).exec()\r\n    .then(respondWithCompleteProfileResult(res))\r\n    .catch(err => next(err));\r\n}\r\n\r\n/**\r\n * Get my info\r\n */\r\nexport function me(req, res, next) {\r\n  let userId = req.user._id;\r\n  return User.findOne({\r\n      _id: userId\r\n    }).exec()\r\n    .then(respondWithBasicProfileResult(res))\r\n    .catch(err => next(err));\r\n}\r\n\r\n/**\r\n * Search user by skill\r\n */\r\nexport function searchBySkill(req, res, next) {\r\n  let query = getQuerySearchSkill(req.query);\r\n  if (!query) {\r\n    return res.status(200).json([]); // if none skill is passed, we dont return users\r\n  }\r\n  return User.find(query).exec()\r\n    .then(respondWithBasicProfileResultList(res))\r\n    .catch(handleError(res));\r\n}\r\n\r\n\r\n//  NEW ENDPOINTS AND AUX FUNCTIONS\r\n\r\nfunction getErrorObject(error) {\r\n  return {\r\n    \"error\": error\r\n  };\r\n}\r\n\r\nfunction findUserPropertyAndUpdateByUserProperty(req, res, action, propertyName) {\r\n  const username = req.params.username;\r\n  const propertyId = req.params.id;\r\n  const propertyValue = req.body.data;\r\n  return findUserByUsername(username)\r\n    .then(handleUserNotFound(res))\r\n    .then(action(res, propertyName, propertyId, propertyValue))\r\n    .catch(handleError(res));\r\n\r\n}\r\n\r\nfunction findUserAndCreateUserProperty(req, res, propertyName) {\r\n  const username = req.params.username;\r\n  return findUserByUsername(username)\r\n    .then(handleUserNotFound(res))\r\n    .then(createUserProperty(res, propertyName, req.body.data))\r\n    .catch(handleError(res));\r\n}\r\n\r\nfunction saveEntity(res, entity, returnValue, code) {\r\n  code = code || 200;\r\n  return entity.save(function(err, doc) {\r\n    if (err) return handleError(err);\r\n    return res.status(code).json(returnValue);\r\n  });\r\n}\r\n\r\nfunction updateUserProperty(res, propertyName, propertyId, propertyValue) {\r\n  return function(entity) {\r\n    let property = entity[propertyName].id(propertyId);\r\n    if (!property) {\r\n      return res.status(404).json(getErrorObject(userWithPropertyNotFoundMsg));\r\n    }\r\n    let index = entity[propertyName].indexOf(property);\r\n    entity[propertyName].set(index, propertyValue); //embebbed array must use set\r\n    return saveEntity(res, entity, entity[propertyName][index]);\r\n  };\r\n}\r\n\r\nfunction deleteUserProperty(res, propertyName, propertyId, propertyValue) {\r\n  return function(entity) {\r\n    let property = entity[propertyName].id(propertyId);\r\n    if (!property) {\r\n      return res.status(404).json(getErrorObject(userWithPropertyNotFoundMsg));\r\n    }\r\n    property.remove();\r\n    return saveEntity(res, entity, {}, 204);\r\n  };\r\n}\r\n\r\nfunction createUserProperty(res, propertyName, propertyValue) {\r\n  return function(entity) {\r\n    let property = entity[propertyName];\r\n    property.push(propertyValue);\r\n    return saveEntity(res, entity, property[property.length - 1]);\r\n  };\r\n}\r\n\r\n// SKILL\r\n\r\nexport function updateSkill(req, res, next) {\r\n  return findUserPropertyAndUpdateByUserProperty(req, res, updateUserProperty, skillProperty);\r\n}\r\n\r\nexport function deleteSkill(req, res, next) {\r\n  return findUserPropertyAndUpdateByUserProperty(req, res, deleteUserProperty, skillProperty);\r\n}\r\n\r\nexport function createSkill(req, res, next) {\r\n  return findUserAndCreateUserProperty(req, res, skillProperty);\r\n}\r\n\r\n\r\n// Language\r\nexport function updateLanguage(req, res, next) {\r\n  return findUserPropertyAndUpdateByUserProperty(req, res, updateUserProperty, languageProperty);\r\n}\r\n\r\nexport function deleteLanguage(req, res, next) {\r\n  return findUserPropertyAndUpdateByUserProperty(req, res, deleteUserProperty, languageProperty);\r\n}\r\n\r\nexport function createLanguage(req, res, next) {\r\n  return findUserAndCreateUserProperty(req, res, languageProperty);\r\n}\r\n\r\n\r\n// Experience\r\nexport function updateExperience(req, res, next) {\r\n  return findUserPropertyAndUpdateByUserProperty(req, res, updateUserProperty, experienceProperty);\r\n}\r\n\r\nexport function deleteExperience(req, res, next) {\r\n  return findUserPropertyAndUpdateByUserProperty(req, res, deleteUserProperty, experienceProperty);\r\n}\r\n\r\nexport function createExperience(req, res, next) {\r\n  return findUserAndCreateUserProperty(req, res, experienceProperty);\r\n}\r\n\r\n\r\n// Education\r\nexport function updateEducation(req, res, next) {\r\n  return findUserPropertyAndUpdateByUserProperty(req, res, updateUserProperty, educationProperty);\r\n}\r\n\r\nexport function deleteEducation(req, res, next) {\r\n  return findUserPropertyAndUpdateByUserProperty(req, res, deleteUserProperty, educationProperty);\r\n}\r\n\r\nexport function createEducation(req, res, next) {\r\n  return findUserAndCreateUserProperty(req, res, educationProperty);\r\n}\r\n\r\n\r\n// Certification\r\nexport function updateCertification(req, res, next) {\r\n  return findUserPropertyAndUpdateByUserProperty(req, res, updateUserProperty, certificationProperty);\r\n}\r\n\r\nexport function deleteCertification(req, res, next) {\r\n  return findUserPropertyAndUpdateByUserProperty(req, res, deleteUserProperty, certificationProperty);\r\n}\r\n\r\nexport function createCertification(req, res, next) {\r\n  return findUserAndCreateUserProperty(req, res, certificationProperty);\r\n}\r\n\r\n\r\n// Hobby\r\nexport function deleteHobby(req, res, next) {\r\n  return findUserPropertyAndUpdateByUserProperty(req, res, deleteUserProperty, hobbyProperty);\r\n}\r\n\r\nexport function createHobby(req, res, next) {\r\n  return findUserAndCreateUserProperty(req, res, hobbyProperty);\r\n}\r\n\r\n// positions\r\nexport function deletePosition(req, res, next) {\r\n  return findUserPropertyAndUpdateByUserProperty(req, res, deleteUserProperty, positionProperty);\r\n}\r\n\r\nexport function createPosition(req, res, next) {\r\n  return findUserAndCreateUserProperty(req, res, positionProperty);\r\n}\r\n\r\n\r\n//Simple field\r\nfunction updateSimpleField(res, propertyName, propertyValue) {\r\n  return function(entity) {\r\n    entity[propertyName] = propertyValue;\r\n    return saveEntity(res, entity, {\r\n      'data': entity[propertyName]\r\n    });\r\n  };\r\n}\r\n\r\nfunction findUserAndUpdateProperty(req, res, action, propertyName) {\r\n  const username = req.params.username;\r\n  const propertyValue = req.body.data;\r\n  console.log('Property Value - ' + propertyValue);\r\n  return findUserByUsername(username)\r\n    .then(handleUserNotFound(res))\r\n    .then(action(res, propertyName, propertyValue))\r\n    .catch(handleError(res));\r\n}\r\n\r\nexport function updateAboutMe(req, res, next) {\r\n  return findUserAndUpdateProperty(req, res, updateSimpleField, aboutMeProperty);\r\n}\r\n\r\nexport function updateSummary(req, res, next) {\r\n  return findUserAndUpdateProperty(req, res, updateSimpleField, summaryOfQualificationProperty);\r\n}\r\n\r\nexport function updateFacebook(req, res, next) {\r\n  return findUserAndUpdateProperty(req, res, updateSimpleField, facebookContactProperty);\r\n}\r\n\r\nexport function updateTwitter(req, res, next) {\r\n  return findUserAndUpdateProperty(req, res, updateSimpleField, twitterContactProperty);\r\n}\r\n\r\nexport function updateLinkedin(req, res, next) {\r\n  return findUserAndUpdateProperty(req, res, updateSimpleField, linkedinContactProperty);\r\n}\r\n\r\nexport function updateSkype(req, res, next) {\r\n  return findUserAndUpdateProperty(req, res, updateSimpleField, skypeContactProperty);\r\n}\r\n\r\n\r\n/**\r\n * Authentication callback\r\n */\r\nexport function authCallback(req, res, next) {\r\n  res.redirect('/');\r\n}\r\n\r\n/**\r\n * Sort an array of results\r\n */\r\n\r\nfunction sortResults(arr, field, asc) {\r\n  arr = arr.sort(function(el1, el2) {\r\n    if (asc) {\r\n      return (el1[field] > el2[field]) ? 1 : ((el1[field] < el2[field]) ? -1 : 0);\r\n    } else {\r\n      return (el2[field] > el1[field]) ? 1 : ((el2[field] < el1[field]) ? -1 : 0);\r\n    }\r\n  });\r\n}\r\n"],"sourceRoot":"/source/"}